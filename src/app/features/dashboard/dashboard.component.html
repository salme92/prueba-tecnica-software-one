<section class="dashboard">
  <header class="dashboard__header">
    <div>
      <h2>Dashboard</h2>
      <p class="dashboard__subtitle">
        Resumen de posts (API JSONPlaceholder) con paginación, búsqueda, CRUD y
        gráfico simple.
      </p>
    </div>

    <div class="dashboard__actions">
      <button mat-raised-button color="primary" (click)="reload()">
        Recargar
      </button>
    </div>
  </header>

  <!-- Usuario destacado -->
  <section class="dashboard__user">
    <h3>Usuario destacado</h3>
    <app-user-card [userId]="1"></app-user-card>
  </section>

  <!-- Gráfico simple: posts por usuario -->
  <section class="dashboard__chart" *ngIf="postsByUser.length">
    <h3>Posts por usuario (página actual)</h3>
    <div class="dashboard__chart-row" *ngFor="let item of postsByUser">
      <span class="dashboard__chart-label">User {{ item.userId }}</span>
      <div class="dashboard__chart-bar-wrapper">
        <div
          class="dashboard__chart-bar"
          [style.width.%]="(item.count / maxPostsPerUser) * 100"
        ></div>
      </div>
      <span class="dashboard__chart-value">{{ item.count }}</span>
    </div>
  </section>

  <!-- Filtros -->
  <section class="dashboard__filters">
    <mat-form-field appearance="outline" class="dashboard__search-field">
      <mat-label>Buscar</mat-label>
      <input
        matInput
        type="text"
        placeholder="Buscar por texto..."
        (keyup.enter)="applySearch($any($event.target).value)"
      />
    </mat-form-field>
  </section>

  <!-- Listado de posts -->
  <section class="dashboard__content">
    <app-loading-spinner *ngIf="loading"></app-loading-spinner>

    <div *ngIf="error && !loading" class="dashboard__error">
      {{ error }}
    </div>

    <ul *ngIf="!loading && !error" class="dashboard__list">
      <li
        class="dashboard__item"
        *ngFor="let post of posts; trackBy: trackByPostId"
        (click)="selectPost(post)"
      >
        <h3 class="dashboard__item-title">
          #{{ post.id }} - {{ post.title }}
        </h3>
        <p class="dashboard__item-body">{{ post.body }}</p>
      </li>
    </ul>
  </section>

  <!-- Paginación -->
  <footer class="dashboard__footer" *ngIf="!loading && !error">
    <button
      mat-stroked-button
      (click)="prevPage()"
      [disabled]="currentPage === 1"
    >
      Anterior
    </button>

    <span class="dashboard__page">Página {{ currentPage }}</span>

    <button mat-stroked-button (click)="nextPage()">Siguiente</button>
  </footer>

  <!-- Editor CRUD -->
  <section class="dashboard__editor">
    <mat-card>
      <header class="dashboard__editor-header">
        <h3>
          {{ isEditing ? 'Editar post' : 'Crear nuevo post' }}
        </h3>
        <button mat-button type="button" (click)="newPost()">
          Nuevo
        </button>
      </header>

      <form (ngSubmit)="savePost()" class="dashboard__editor-form">
        <mat-form-field appearance="outline">
          <mat-label>Título</mat-label>
          <input
            matInput
            name="title"
            [(ngModel)]="editablePost.title"
            placeholder="Título del post"
          />
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Contenido</mat-label>
          <textarea
            matInput
            name="body"
            rows="4"
            [(ngModel)]="editablePost.body"
            placeholder="Contenido del post"
          ></textarea>
        </mat-form-field>

        <div class="dashboard__editor-actions">
          <button mat-raised-button color="primary" type="submit">
            Guardar
          </button>

          <button
            mat-stroked-button
            color="warn"
            type="button"
            (click)="deletePost()"
            [disabled]="!isEditing || !editablePost.id"
          >
            Eliminar
          </button>
        </div>
      </form>
    </mat-card>
  </section>
</section>
